<!DOCTYPE html>
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
        <link rel="stylesheet" href="bootstrap-3.3.5-dist/css/bootstrap.css" />
        <link rel="stylesheet" href="style3.css" />
        <title>Wine quality</title>
    </head>
<body>
<script src="d3/d3.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="script.js"></script>
<script src="box.js"></script>
<h2> What make a good wine ? </h2>
<ul class="nav nav-tabs">
    <li role="presentation" class="active"><a href="TestD3.html">White wine</a></li>
    <li role="presentation"><a href="#">Red wine</a></li>
</ul>

<div id="data">
<div id="tool-box">
<p id="tool-titre"><a href="TestD3.html">Chemical components link with quality</a></p>
<p id="tool-titre"><a href="AlcoholAcidity.html"> Alcohol and acidity </a></p>
<form>
  <label><input type="checkbox" name="quality" value="Bad" checked><font color="#fc8d59">Bad wine</font></label>
  <label><input type="checkbox" name="quality" value="Good" checked><font color="#91cf60">Good wine</font></label>
  <label><input type="checkbox" name="quality" value="Mediocre" checked><font color="#E6E2AF">Common wine</font></label>
</form>
<script>
var w = 500;
var h= 500;

var data= []; 
/*creer un tableau par couleur qui correspond à une categorie de qualité de vin*/ 
data[0]={}; data[1]={}; data[2]={}; 
/*data[3]={};*/
obj={};
data[4]=[];

for(var i=0; i<4; i++) {
  data[4][i] =[] // Ce qu'on veut afficher
}

var rowMax = [];
var rowMin = [];
var max = [];
var min = [];
for (var it=1; it<6; it++){
  max[it] = 0;
  min[it] = 10000000000;
}

d3.csv("data/wine_white.csv", function(data1) {
        data1.forEach(function(d) {
            var v1 = d.quality,
                v2 = d.alcohol,
                v3 = d.fixedacidity;

            if (d.quality<5) {
              obj.color = "#fc8d59";
              obj.quality = v1;
              obj.alcohol = v2;
              obj.fixedacidity = v3;
              data[4][0].push(obj);
              obj={};
            }
            if (v1>6) {
              obj.color = "#91cf60";
              obj.quality = v1;
              obj.alcohol = v2;
              obj.fixedacidity = v3;
              data[4][1].push(obj);
              obj={};
            }
            if (v1==5 || v1==6){
              obj.color = "#E6E2AF";
              obj.quality = v1;
              obj.alcohol = v2;
              obj.fixedacidity = v3;
              data[4][2].push(obj);
              obj={};
            }
            /*if (v1==6){
              obj.color = "#DBA901";
              obj.quality = v1;
              obj.alcohol = v2;
              obj.fixedacidity = v3;
              data[4][3].push(obj);
              obj={};
            }*/

            rowMax[1] = v1;
            rowMin[1] = v1;
            rowMax[2] = v2;
            rowMin[2] = v2;
            //rowMax[3] = v3;
            //rowMin[3] = v3;

            for (var iter=1; iter<3; iter++){
              if (rowMax[iter] > max[iter]) {
                //console.log(rowMax[iter] + " " + max[iter]);
                max[iter] = rowMax[iter];
                //console.log(max[iter]);
              }
              if (rowMin[iter] < min[iter]) {
                             //   console.log(iter + " " + rowMin[iter] + " " + min[iter]);

                min[iter] = rowMin[iter];
                             //   console.log(min[iter]);etonant je ne sais pas ce que fait le if mais ça bug

              }
            }
        });
        var xScale = d3.scale.linear()
                     .domain([6, 15])//remettre min et max
                     .range([0, w]);
        var yScale = d3.scale.linear()
                     .domain([13.5, 2.5])
                     .range([0, h]);

        var svg = d3.select("div").append("svg");
        svg.attr("width", 800)
           .attr("height", 2000);

        svg.append("g")
          .attr("class", "axis")
          .attr("transform", "translate(" + 30 + "," + (h) + ")")
          .call(d3.svg.axis()
                      .scale(xScale)
                      .orient("bottom"));

        svg.append("text")
           .attr("x",w/2)
           .attr("y",h + 45)
           .style("text-anchor","middle")
           .text("Alcohol");

        svg.append("g")
          .attr("class", "axis")
          .attr("transform", "translate(" + 20 + ",0)")
          .call(d3.svg.axis()
                      .scale(yScale)
                      .orient("left"));

        svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0 - 28)
        .attr("x",0 - (h / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Acidity");

//show or not bad wine
        var circles = svg.selectAll("circle")
           .data(data[4][0])
           .enter()
           .append("circle");

        circles.attr("cx", function(d) {
          //console.log(d.alcohol);

               return xScale(d.alcohol); //d.quality*50
            })
          .attr("cy", function(d) {
               return yScale(d.fixedacidity); //d.density*15000-14800
            })
          .attr("r", 4)
          .attr("fill", function(d) { return d.color; })
          .attr("stroke", "#0431B4")
          .attr("stroke-width", function(d) {
              return d/3;
            })
          .style("opacity",1);

//show or not Good wine
        var circles2 = svg.selectAll("circle")
           .data(data[4][1])
           .enter()
           .append("circle");

        circles2.attr("cx", function(d) {
          //console.log(d.alcohol);

               return xScale(d.alcohol); //d.quality*50
            })
          .attr("cy", function(d) {
               return yScale(d.fixedacidity); //d.density*15000-14800
            })
          .attr("r", 4)
          .attr("fill", function(d) { return d.color; })
          .attr("stroke", "#0431B4")
          .attr("stroke-width", function(d) {
              return d/3;
            })
          .style("opacity",1);

//show or not Mediocre wine
        var circles3 = svg.selectAll("circle")
           .data(data[4][2])
           .enter()
           .append("circle");

        circles3.attr("cx", function(d) {
               return xScale(d.alcohol);
            })
          .attr("cy", function(d) {
               return yScale(d.fixedacidity);
            })
          .attr("r", 4)
          .attr("fill", function(d) { return d.color; })
          .attr("stroke", "#0431B4")
          .attr("stroke-width", function(d) {
              return d/3;
            })
          .style("opacity",1);

//show or not OK wine
       /* var circles4 = svg.selectAll("circle")
           .data(data[4][3])
           .enter()
           .append("circle");

        circles4.attr("cx", function(d) {
               return xScale(d.alcohol);
            })
          .attr("cy", function(d) {
               return yScale(d.fixedacidity);
            })
          .attr("r", 4)
          .attr("fill", function(d) { return d.color; })
          .attr("stroke", "#0431B4")
          .attr("stroke-width", function(d) {
              return d/3;
            })
          .style("opacity",0);*/

        d3.selectAll("input").on("change", change);

        var checked = [];
        checked[1] = true; //Bad
        checked[2] = true, //Good
        checked[3] = true; //Med
        //checked[4] = false; //OK
        function change() {
            //clearTimeout(timeout);
            switch(this.value) {
                case "Mediocre":
                  checked[3]   = !checked[3];
                  Mediocre();
                    break;
                case "Good":
                  checked[2]   = !checked[2];
                  Good();
                    break;
                case "Bad":
                  checked[1]   = !checked[1];
                  Bad();
                    break;
                default:
            }
          }

        function Good() {
          if (checked[2]==true) {
            circles2.style("opacity",0.7);
          }
          else {
            circles2.style("opacity",0);
          }
        }

        function Bad() {
          if (checked[1]==true) {
            circles.style("opacity",0.7);
          }
          else {
            circles.style("opacity",0);
          }
        }

        function Mediocre() {
          if (checked[3]==true) {
            circles3.style("opacity",0.7);
          }
          else {
            circles3.style("opacity",0);
          }
        }



  });
</script>
